<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${modeModification and apprenti != null and apprenti.nomComplet != null ? ('Modifier ' + apprenti.nomComplet + ' - ASTA') : 'Ajouter un apprenti - ASTA'}">Formulaire apprenti - ASTA</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link th:href="@{/css/app.css}" rel="stylesheet">
</head>
<body class="bg-light">
    
    <!-- Navigation unifiée -->
    <div th:replace="~{fragments/header :: navbar('apprentis')}"></div>

    <div class="container-fluid">
        <div class="content-wrapper">
        
        <!-- Messages flash -->
        <div th:replace="~{fragments/messages :: all}"></div>

        <!-- Breadcrumb -->
        <div th:replace="~{fragments/breadcrumb :: apprentis(${modeModification and apprenti != null and apprenti.nomComplet != null ? ('Modifier ' + apprenti.nomComplet) : 'Ajouter un apprenti'})}"></div>

        <!-- En-tête -->
        <div class="row mb-4">
            <div class="col-md-8">
                <div class="d-flex align-items-center">
                    <div class="me-3">
                        <div th:class="'avatar-circle ' + (${modeModification ? 'bg-warning' : 'bg-success'}) + ' rounded-circle d-flex align-items-center justify-content-center'">
                            <i th:class="${modeModification ? 'fas fa-user-edit' : 'fas fa-user-plus'} + ' fa-2x text-white'"></i>
                        </div>
                    </div>
                    <div>
                        <h1 class="h2 mb-1" th:text="${modeModification and apprenti != null and apprenti.nomComplet != null ? ('Modifier ' + apprenti.nomComplet) : 'Ajouter un nouvel apprenti'}">
                            Formulaire apprenti
                        </h1>
                        <p class="text-muted mb-0">
                            <span th:if="${modeModification}">
                                <i class="fas fa-edit me-1"></i>Modification des informations existantes
                            </span>
                            <span th:unless="${modeModification}">
                                <i class="fas fa-plus me-1"></i>Création d'un nouveau profil apprenti
                            </span>
                        </p>
                    </div>
                </div>
            </div>
            <div class="col-md-4 text-end">
                <div class="btn-group" role="group">
                    <a th:href="${modeModification and apprenti != null and apprenti.id != null ? '/web/apprentis/' + apprenti.id : '/web/apprentis'}" 
                       class="btn btn-secondary">
                        <i class="fas fa-arrow-left me-2"></i>Annuler
                    </a>
                </div>
            </div>
        </div>

        <!-- Formulaire -->
        <div class="row justify-content-center">
            <div class="col-lg-10">
                <form th:object="${apprenti}" 
                      th:action="${modeModification and apprenti != null and apprenti.id != null ? '/web/apprentis/' + apprenti.id + '/modifier' : '/web/apprentis/ajouter'}" 
                      method="post">
                    
                    <!-- Champ caché pour l'ID en mode modification -->
                    <input th:if="${modeModification}" type="hidden" th:field="*{id}" />
                    
                    <!-- Message informatif -->
                    <div class="alert alert-info d-flex align-items-center mb-4" role="alert">
                        <i class="fas fa-info-circle me-2"></i>
                        <div>
                            <strong>Information :</strong> L'année académique est automatiquement assignée à l'année courante pour tous les apprentis.
                        </div>
                    </div>
                    
                    <!-- Informations personnelles -->
                    <div class="card shadow-sm mb-4">
                        <div class="card-header bg-primary text-white">
                            <h5 class="mb-0">
                                <i class="fas fa-user me-2"></i>Informations personnelles
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="row g-3">
                                <!-- Nom -->
                                <div class="col-md-6">
                                    <div class="form-floating">
                                        <input type="text" 
                                               th:field="*{nom}" 
                                               class="form-control" 
                                               id="nom" 
                                               placeholder="Nom de famille"
                                               required
                                               maxlength="100"
                                               th:classappend="${#fields.hasErrors('nom')} ? 'is-invalid' : ''">
                                        <label for="nom">Nom de famille *</label>
                                        <div th:if="${#fields.hasErrors('nom')}" class="invalid-feedback">
                                            <i class="fas fa-times-circle text-danger me-1"></i>
                                            <span th:text="${#fields.errors('nom')[0]}">Erreur nom</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Prénom -->
                                <div class="col-md-6">
                                    <div class="form-floating">
                                        <input type="text" 
                                               th:field="*{prenom}" 
                                               class="form-control" 
                                               id="prenom" 
                                               placeholder="Prénom"
                                               required
                                               maxlength="100"
                                               th:classappend="${#fields.hasErrors('prenom')} ? 'is-invalid' : ''">
                                        <label for="prenom">Prénom *</label>
                                        <div th:if="${#fields.hasErrors('prenom')}" class="invalid-feedback">
                                            <i class="fas fa-times-circle text-danger me-1"></i>
                                            <span th:text="${#fields.errors('prenom')[0]}">Erreur prénom</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Email -->
                                <div class="col-md-8">
                                    <div class="form-floating">
                                        <input type="email" 
                                               th:field="*{email}" 
                                               class="form-control" 
                                               id="email" 
                                               placeholder="email@exemple.com"
                                               required
                                               maxlength="100"
                                               th:classappend="${#fields.hasErrors('email')} ? 'is-invalid' : ''">
                                        <label for="email">Adresse email *</label>
                                        <div th:if="${#fields.hasErrors('email')}" class="invalid-feedback">
                                            <i class="fas fa-times-circle text-danger me-1"></i>
                                            <span th:text="${#fields.errors('email')[0]}">Erreur email</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Téléphone -->
                                <div class="col-md-4">
                                    <div class="form-floating">
                                        <input type="tel" 
                                               th:field="*{telephone}" 
                                               class="form-control" 
                                               id="telephone" 
                                               placeholder="06 12 34 56 78"
                                               maxlength="15"
                                               th:classappend="${#fields.hasErrors('telephone')} ? 'is-invalid' : ''">
                                        <label for="telephone">Téléphone (optionnel)</label>
                                        <div th:if="${#fields.hasErrors('telephone')}" class="invalid-feedback">
                                            <i class="fas fa-times-circle text-danger me-1"></i>
                                            <span th:text="${#fields.errors('telephone')[0]}">Erreur téléphone</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Informations académiques -->
                    <div class="card shadow-sm mb-4">
                        <div class="card-header bg-success text-white">
                            <h5 class="mb-0">
                                <i class="fas fa-graduation-cap me-2"></i>Informations académiques
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="row g-3">
                                <!-- Programme -->
                                <div class="col-md-4">
                                    <div class="form-floating">
                                        <select th:field="*{programme}" 
                                                class="form-select" 
                                                id="programme"
                                                required
                                                th:classappend="${#fields.hasErrors('programme')} ? 'is-invalid' : ''">
                                            <option value="">Choisissez un programme...</option>
                                            <option value="I1">I1 - Première année</option>
                                            <option value="I2">I2 - Deuxième année</option>
                                            <option value="I3">I3 - Troisième année</option>
                                        </select>
                                        <label for="programme">Programme d'études *</label>
                                        <div th:if="${#fields.hasErrors('programme')}" class="invalid-feedback">
                                            <span th:errors="*{programme}">Erreur programme</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Majeure -->
                                <div class="col-md-8">
                                    <div class="form-floating">
                                        <select th:field="*{majeure}" 
                                                class="form-select" 
                                                id="majeure"
                                                required
                                                th:classappend="${#fields.hasErrors('majeure')} ? 'is-invalid' : ''">
                                            <option value="">Choisissez une majeure...</option>
                                            <option value="Digital Transformation">Digital Transformation</option>
                                            <option value="Data Science">Data Science</option>
                                            <option value="Cybersécurité">Cybersécurité</option>
                                            <option value="Intelligence Artificielle">Intelligence Artificielle</option>
                                            <option value="Développement Logiciel">Développement Logiciel</option>
                                            <option value="Systèmes et Réseaux">Systèmes et Réseaux</option>
                                        </select>
                                        <label for="majeure">Majeure/Spécialisation *</label>
                                        <div th:if="${#fields.hasErrors('majeure')}" class="invalid-feedback">
                                            <span th:errors="*{majeure}">Erreur majeure</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- L'année académique est automatiquement assignée côté serveur -->

                                <!-- Statut archivé (seulement en modification) -->
                                <div class="col-md-6" th:if="${modeModification}">
                                    <div class="form-check form-switch mt-3">
                                        <input class="form-check-input" 
                                               type="checkbox" 
                                               th:field="*{estArchive}" 
                                               id="estArchive">
                                        <label class="form-check-label" for="estArchive">
                                            <i class="fas fa-archive me-1"></i>Apprenti archivé
                                        </label>
                                        <div class="form-text text-warning">
                                            <i class="fas fa-warning me-1"></i>
                                            Un apprenti archivé n'apparaîtra plus dans la liste active
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Encadrement professionnel -->
                    <div class="card shadow-sm mb-4">
                        <div class="card-header bg-warning text-dark">
                            <h5 class="mb-0">
                                <i class="fas fa-chalkboard-teacher me-2"></i>Encadrement professionnel
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="row g-3">
                                <!-- Maître d'apprentissage -->
                                <div class="col-md-6">
                                    <div class="form-floating">
                                        <select th:field="*{maitreApprentissage.id}" 
                                                class="form-select" 
                                                id="maitreApprentissage"
                                                required
                                                th:classappend="${#fields.hasErrors('maitreApprentissage')} ? 'is-invalid' : ''">
                                            <option value="">Choisissez un maître d'apprentissage...</option>
                                            <option th:each="maitre : ${maitres}" 
                                                    th:value="${maitre.id}" 
                                                    th:text="${maitre.prenom + ' ' + maitre.nom + ' (' + maitre.poste + ')'}"
                                                    th:selected="${apprenti.maitreApprentissage != null and apprenti.maitreApprentissage.id == maitre.id}">
                                                Sophie MARTIN (Lead Developer)
                                            </option>
                                        </select>
                                        <label for="maitreApprentissage">Maître d'apprentissage *</label>
                                        <div th:if="${#fields.hasErrors('maitreApprentissage')}" class="invalid-feedback">
                                            <span th:errors="*{maitreApprentissage}">Erreur maître d'apprentissage</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Entreprise -->
                                <div class="col-md-6">
                                    <div class="form-floating">
                                        <select th:field="*{entreprise.id}" 
                                                class="form-select" 
                                                id="entreprise"
                                                th:classappend="${#fields.hasErrors('entreprise')} ? 'is-invalid' : ''">
                                            <option value="">Pas d'entreprise assignée</option>
                                            <option th:each="entreprise : ${entreprises}" 
                                                    th:value="${entreprise.id}" 
                                                    th:text="${entreprise.raisonSociale}"
                                                    th:selected="${apprenti.entreprise != null and apprenti.entreprise.id == entreprise.id}">
                                                Entreprise XYZ
                                            </option>
                                        </select>
                                        <label for="entreprise">Entreprise (optionnel)</label>
                                        <div th:if="${#fields.hasErrors('entreprise')}" class="invalid-feedback">
                                            <span th:errors="*{entreprise}">Erreur entreprise</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Feedback tuteur (seulement en modification) -->
                                <div class="col-12" th:if="${modeModification}">
                                    <div class="form-floating">
                                        <textarea th:field="*{feedbackTuteurEnseignant}" 
                                                  class="form-control" 
                                                  id="feedbackTuteur" 
                                                  placeholder="Commentaires du tuteur enseignant..."
                                                  style="height: 120px"
                                                  maxlength="500"
                                                  th:classappend="${#fields.hasErrors('feedbackTuteurEnseignant')} ? 'is-invalid' : ''"></textarea>
                                        <label for="feedbackTuteur">Feedback du tuteur enseignant</label>
                                        <div th:if="${#fields.hasErrors('feedbackTuteurEnseignant')}" class="invalid-feedback">
                                            <span th:errors="*{feedbackTuteurEnseignant}">Erreur feedback</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Informations de la Mission -->
                    <div class="card mb-4 shadow-sm">
                        <div class="card-header bg-info text-white">
                            <h5 class="card-title mb-0">
                                <i class="fas fa-briefcase me-2"></i>Mission en entreprise
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="row g-3">
                                <!-- Mots clés -->
                                <div class="col-md-6">
                                    <div class="form-floating">
                                        <input th:field="*{mission.motsCles}" 
                                               type="text" 
                                               class="form-control" 
                                               id="missionMotsCles" 
                                               placeholder="Développement, Java, Spring..."
                                               maxlength="200"
                                               th:classappend="${#fields.hasErrors('mission.motsCles')} ? 'is-invalid' : ''">
                                        <label for="missionMotsCles">Mots-clés de la mission</label>
                                        <div class="form-text">
                                            <i class="fas fa-info-circle me-1"></i>Séparez les mots-clés par des virgules
                                        </div>
                                        <div th:if="${#fields.hasErrors('mission.motsCles')}" class="invalid-feedback">
                                            <span th:errors="*{mission.motsCles}">Erreur mots-clés</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Métier cible -->
                                <div class="col-md-6">
                                    <div class="form-floating">
                                        <input th:field="*{mission.metierCible}" 
                                               type="text" 
                                               class="form-control" 
                                               id="missionMetier" 
                                               placeholder="Développeur Full-Stack..."
                                               maxlength="100"
                                               th:classappend="${#fields.hasErrors('mission.metierCible')} ? 'is-invalid' : ''">
                                        <label for="missionMetier">Métier cible</label>
                                        <div class="form-text">
                                            <i class="fas fa-target me-1"></i>Le métier visé par cette mission
                                        </div>
                                        <div th:if="${#fields.hasErrors('mission.metierCible')}" class="invalid-feedback">
                                            <span th:errors="*{mission.metierCible}">Erreur métier cible</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Commentaires sur la mission -->
                                <div class="col-12">
                                    <div class="form-floating">
                                        <textarea th:field="*{mission.commentaires}" 
                                                  class="form-control" 
                                                  id="missionCommentaires" 
                                                  placeholder="Décrivez les objectifs, les tâches principales..."
                                                  style="height: 120px"
                                                  maxlength="500"
                                                  th:classappend="${#fields.hasErrors('mission.commentaires')} ? 'is-invalid' : ''"></textarea>
                                        <label for="missionCommentaires">Commentaires sur la mission</label>
                                        <div class="form-text">
                                            <i class="fas fa-comment me-1"></i>Décription détaillée de la mission (objectifs, tâches, etc.)
                                        </div>
                                        <div th:if="${#fields.hasErrors('mission.commentaires')}" class="invalid-feedback">
                                            <span th:errors="*{mission.commentaires}">Erreur commentaires</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Boutons d'action -->
                    <div class="text-end mt-4 mb-4">
                        <div class="btn-group" role="group">
                            <a th:href="${modeModification and apprenti != null and apprenti.id != null ? '/web/apprentis/' + apprenti.id : '/web/apprentis'}" 
                               class="btn btn-secondary">
                                <i class="fas fa-times me-1"></i>Annuler
                            </a>
                            <button type="submit" class="btn btn-success btn-lg">
                                <span th:if="${modeModification}">
                                    <i class="fas fa-save me-2"></i>Enregistrer
                                </span>
                                <span th:unless="${modeModification}">
                                    <i class="fas fa-plus me-2"></i>Ajouter
                                </span>
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
        
        </div> <!-- Fermeture content-wrapper -->
    </div>

    <!-- Scripts Bootstrap -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Script simple -->
    <script>
        // Auto-hide des alertes après 5 secondes
        setTimeout(function() {
            const alerts = document.querySelectorAll('.alert-dismissible');
            alerts.forEach(alert => {
                const bsAlert = new bootstrap.Alert(alert);
                bsAlert.close();
            });
        }, 5000);
    </script>
</body>
</html>